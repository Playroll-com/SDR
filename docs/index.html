<!DOCTYPE html>
<html>
<head>
    <title>Unsubscribe</title>
</head>
<body>
    <h1>Unsubscribe Page</h1>
    <div id="responseMessage"></div>
    <script>
        // Extract query parameters from the initial link
        const urlParams = new URLSearchParams(window.location.search);
        // const esubject = urlParams.get('esubject');
        // const eto = urlParams.get('eto');
        // const edraftId = urlParams.get('edraftId');
        // const estage = urlParams.get('estage');
        const eurl= urlParams.get('eurl');

        // Create the final unsubscribe link with query parameters
        const unsubscribeLink = eurl;

        // Function to trigger the unsubscribe action
        function unsubscribe() {
            // Send a GET request to the unsubscribe link
            fetch(unsubscribeLink, {
                method: 'GET'
            })
            .then(function(response) {
                if (response.ok) {
                    return 200;
                } else {
                    return 400;
                }
            })
            .then(function(responseCode) {
                // Display the response message on the page
                var responseMsg = "Successfully unsubscribed";
                if (responseCode == 400) responseMsg = "Unsubscribe failed";
                const responseMessageElement = document.getElementById('responseMessage');
                responseMessageElement.textContent = responseMsg;
            })
            .catch(function(error) {
                const responseMessageElement = document.getElementById('responseMessage');
                responseMessageElement.textContent = `Error: ${error}`;
                console.error('Error:', error);
            });
        }
    </script>
    <button onclick="unsubscribe()">Unsubscribe</button>
</body>
</html>
